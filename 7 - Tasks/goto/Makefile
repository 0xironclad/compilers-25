COMPILERNAME=while
SCANNERTEST=scantest
GENDIR=autogenerated

all: $(COMPILERNAME)
	-

compiler: $(COMPILERNAME)
	-

scanner: $(GENDIR)/lex.yy.cc
	-

parser: $(GENDIR)/parse.cc
	-

clean:
	rm -rf $(COMPILERNAME) $(SCANNERTEST) $(GENDIR) *~

$(GENDIR)/lex.yy.cc: $(COMPILERNAME).l
	mkdir -p $(GENDIR)
	flex -o $(GENDIR)/lex.yy.cc $(COMPILERNAME).l 

$(GENDIR)/parse.cc: *.y
	mkdir -p $(GENDIR)
	cp Parse* $(GENDIR)/
	bisonc++ $(COMPILERNAME).y --target-directory=$(GENDIR)

$(COMPILERNAME): $(COMPILERNAME).cc $(GENDIR)/lex.yy.cc $(GENDIR)/parse.cc semantics.cc semantics.h
	VSN=$$(bisonc++ --version | cut -f2 -d" " | cut -f1,2 -d"." | tr -d 'V' | tr -d '.'); \
        g++ -DBISONCPP_VSN=$$VSN -o$(COMPILERNAME) $(COMPILERNAME).cc $(GENDIR)/parse.cc $(GENDIR)/lex.yy.cc semantics.cc

$(SCANNERTEST): $(SCANNERTEST).cc $(GENDIR)/lex.yy.cc semantics.cc semantics.h
	VSN=$$(bisonc++ --version | cut -f2 -d" " | cut -f1,2 -d"." | tr -d 'V' | tr -d '.'); \
        g++ -DBISONCPP_VSN=$$VSN -o$(SCANNERTEST) $(SCANNERTEST).cc $(GENDIR)/lex.yy.cc semantics.cc
